<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Life WASM API Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #00d4ff, #0088ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: #888;
        }

        .status {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #00d4ff;
        }

        .status.ready {
            border-left-color: #00ff88;
        }

        .status.error {
            border-left-color: #ff4444;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: #00d4ff;
            font-size: 1.2em;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.9em;
        }

        input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            font-size: 1em;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00d4ff, #0088ff);
            border: none;
            border-radius: 5px;
            color: #fff;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
        }

        button.secondary:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .info-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .info-card .label {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 5px;
        }

        .info-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4ff;
        }

        .console {
            background: #000;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .console-line {
            margin-bottom: 5px;
        }

        .console-line.info { color: #00d4ff; }
        .console-line.success { color: #00ff88; }
        .console-line.error { color: #ff4444; }
        .console-line.warn { color: #ffaa00; }

        .visualization {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            min-height: 200px;
        }

        .cell-grid {
            display: grid;
            gap: 2px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            overflow: auto;
            max-height: 400px;
        }

        .cell {
            width: 20px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 2px;
            transition: background 0.3s;
        }

        .cell.alive {
            background: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Go Life WASM API Test</h1>
        <p class="subtitle">Interactive testing for JavaScript ‚Üî Go WASM communication</p>

        <div id="status" class="status">
            <strong>Status:</strong> <span id="status-text">Loading WASM...</span>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <div class="label">Generation</div>
                <div class="value" id="generation">0</div>
            </div>
            <div class="info-card">
                <div class="label">Population</div>
                <div class="value" id="population">0</div>
            </div>
            <div class="info-card">
                <div class="label">Dimensions</div>
                <div class="value" id="dimensions">-</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <h3>üåå Universe Setup</h3>
                <label>Width</label>
                <input type="number" id="width" value="10" min="1" max="100">

                <label>Height</label>
                <input type="number" id="height" value="10" min="1" max="100">

                <label>Depth</label>
                <input type="number" id="depth" value="10" min="1" max="100">

                <button onclick="initializeUniverse()">Initialize Universe</button>
            </div>

            <div class="control-group">
                <h3>üì¶ Pattern Loading</h3>
                <label>Pattern</label>
                <select id="pattern">
                    <option value="glider">Glider (Bays's)</option>
                    <option value="block">Block 3D</option>
                    <option value="beehive">Beehive 3D</option>
                    <option value="blinker">Blinker (Period 2)</option>
                    <option value="flashlight">Flashlight (Period 4)</option>
                    <option value="wheel">Wheel (Period 2)</option>
                    <option value="bucket">Bucket</option>
                </select>

                <label>X Position</label>
                <input type="number" id="patternX" value="3" min="0">

                <label>Y Position</label>
                <input type="number" id="patternY" value="3" min="0">

                <label>Z Position</label>
                <input type="number" id="patternZ" value="3" min="0">

                <button onclick="loadPattern()">Load Pattern</button>
            </div>

            <div class="control-group">
                <h3>‚öôÔ∏è Simulation Control</h3>
                <button onclick="stepOnce()">Step Once</button>
                <button onclick="stepMultiple()">Step 10x</button>
                <button onclick="startAnimation()" id="animateBtn">Start Animation</button>
                <button onclick="stopAnimation()" class="secondary">Stop Animation</button>
                <button onclick="clearAll()" class="secondary">Clear All</button>
            </div>

            <div class="control-group">
                <h3>üîç Inspection</h3>
                <button onclick="getLivingCells()">Get Living Cells</button>
                <button onclick="getInfo()">Get Universe Info</button>
                <button onclick="testSetCell()">Test SetCell</button>
            </div>
        </div>

        <div class="console" id="console">
            <div class="console-line info">Console output will appear here...</div>
        </div>
    </div>

    <script src="wasm_exec.js"></script>
    <script src="golife-wasm.js"></script>
    <script>
        let wasmAPI = null;
        let animationController = null;

        // Console logging
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            line.textContent = `[${timestamp}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        function updateStatus(text, isReady = false, isError = false) {
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('status-text');
            statusText.textContent = text;

            statusDiv.className = 'status';
            if (isReady) statusDiv.classList.add('ready');
            if (isError) statusDiv.classList.add('error');
        }

        function updateInfo() {
            if (!wasmAPI || !wasmAPI.isReady()) return;

            const info = wasmAPI.getUniverseInfo();
            if (info.error) {
                log(`Info error: ${info.error}`, 'error');
                return;
            }

            document.getElementById('generation').textContent = info.generation || 0;
            document.getElementById('population').textContent = info.population || 0;
            document.getElementById('dimensions').textContent =
                info.width && info.height && info.depth
                    ? `${info.width}√ó${info.height}√ó${info.depth}`
                    : '-';
        }

        // API functions
        async function initializeUniverse() {
            const width = parseInt(document.getElementById('width').value);
            const height = parseInt(document.getElementById('height').value);
            const depth = parseInt(document.getElementById('depth').value);

            log(`Initializing universe: ${width}√ó${height}√ó${depth}...`);
            const result = wasmAPI.initUniverse(width, height, depth);

            if (result.error) {
                log(`‚ùå Error: ${result.error}`, 'error');
            } else {
                log(`‚úÖ Universe initialized: ${width}√ó${height}√ó${depth}`, 'success');
                updateInfo();
            }
        }

        async function loadPattern() {
            const pattern = document.getElementById('pattern').value;
            const x = parseInt(document.getElementById('patternX').value);
            const y = parseInt(document.getElementById('patternY').value);
            const z = parseInt(document.getElementById('patternZ').value);

            log(`Loading pattern '${pattern}' at (${x}, ${y}, ${z})...`);
            const result = wasmAPI.loadPattern(pattern, x, y, z);

            if (result.error) {
                log(`‚ùå Error: ${result.error}`, 'error');
            } else {
                log(`‚úÖ Pattern loaded: ${pattern}`, 'success');
                updateInfo();
            }
        }

        function stepOnce() {
            log('Stepping simulation...');
            const result = wasmAPI.step();

            if (result.error) {
                log(`‚ùå Error: ${result.error}`, 'error');
            } else {
                log(`‚úÖ Step complete. Generation: ${result.generation}`, 'success');
                updateInfo();
            }
        }

        async function stepMultiple() {
            log('Running 10 generations...');
            try {
                await wasmAPI.run(10, (state, gen) => {
                    if (gen % 5 === 0) {
                        log(`  Generation ${gen}: ${state.population} cells alive`);
                    }
                });
                log('‚úÖ 10 generations complete', 'success');
                updateInfo();
            } catch (err) {
                log(`‚ùå Error: ${err.message}`, 'error');
            }
        }

        function startAnimation() {
            if (animationController) {
                log('Animation already running', 'warn');
                return;
            }

            log('Starting animation at 10 FPS...');
            animationController = wasmAPI.startAnimation((state, generation) => {
                updateInfo();
                if (generation % 10 === 0) {
                    log(`  Generation ${generation}: ${state.population} cells`);
                }
            }, 10);

            document.getElementById('animateBtn').disabled = true;
            log('‚úÖ Animation started', 'success');
        }

        function stopAnimation() {
            if (!animationController) {
                log('No animation running', 'warn');
                return;
            }

            animationController.stop();
            animationController = null;
            document.getElementById('animateBtn').disabled = false;
            log('‚è∏Ô∏è Animation stopped', 'success');
        }

        function clearAll() {
            log('Clearing universe...');
            const result = wasmAPI.clearUniverse();

            if (result.error) {
                log(`‚ùå Error: ${result.error}`, 'error');
            } else {
                log('‚úÖ Universe cleared', 'success');
                updateInfo();
            }
        }

        function getLivingCells() {
            log('Fetching living cells...');
            const state = wasmAPI.getLivingCells();

            if (state.error) {
                log(`‚ùå Error: ${state.error}`, 'error');
                return;
            }

            log(`‚úÖ Found ${state.cells.length} living cells`, 'success');
            log(`  Generation: ${state.generation}`, 'info');
            log(`  Population: ${state.population}`, 'info');
            log(`  Dimensions: ${state.width}√ó${state.height}√ó${state.depth}`, 'info');

            if (state.cells.length > 0) {
                log(`  Sample cells: ${JSON.stringify(state.cells.slice(0, 5))}`, 'info');
            }
        }

        function getInfo() {
            log('Fetching universe info...');
            const info = wasmAPI.getUniverseInfo();

            if (info.error) {
                log(`‚ùå Error: ${info.error}`, 'error');
                return;
            }

            log(`‚úÖ Universe info:`, 'success');
            log(`  Dimensions: ${info.width}√ó${info.height}√ó${info.depth}`, 'info');
            log(`  Generation: ${info.generation}`, 'info');
            log(`  Population: ${info.population}`, 'info');
        }

        function testSetCell() {
            log('Testing setCell...');

            // Set cell at (5, 5, 5) to alive
            const result1 = wasmAPI.setCell(5, 5, 5, true);
            if (result1.error) {
                log(`‚ùå Error setting cell: ${result1.error}`, 'error');
                return;
            }

            log('‚úÖ Cell (5,5,5) set to alive', 'success');

            // Set cell at (6, 5, 5) to alive
            const result2 = wasmAPI.setCell(6, 5, 5, true);
            if (result2.error) {
                log(`‚ùå Error setting cell: ${result2.error}`, 'error');
                return;
            }

            log('‚úÖ Cell (6,5,5) set to alive', 'success');
            updateInfo();
        }

        // Initialize on page load
        window.addEventListener('load', async () => {
            try {
                wasmAPI = new GoLifeWASM();
                await wasmAPI.load('life3d.wasm');

                updateStatus('‚úÖ WASM Ready', true);
                log('üöÄ Go Life WASM API ready!', 'success');
                log('Click "Initialize Universe" to start', 'info');

            } catch (err) {
                updateStatus(`‚ùå Failed to load WASM: ${err.message}`, false, true);
                log(`‚ùå WASM load error: ${err.message}`, 'error');
            }
        });
    </script>
</body>
</html>
